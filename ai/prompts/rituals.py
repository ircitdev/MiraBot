"""
Ritual Prompts.
–ü—Ä–æ–º–ø—Ç—ã –¥–ª—è —Ä–∏—Ç—É–∞–ª–æ–≤ –∏ –ø—Ä–æ–∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.
"""

import random
from typing import Dict, Any, Optional, List

# –£—Ç—Ä–µ–Ω–Ω–∏–µ check-in —Å–æ–æ–±—â–µ–Ω–∏—è
MORNING_CHECKIN_PROMPTS: List[str] = [
    "–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ ‚òÄÔ∏è –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–µ–≥–æ–¥–Ω—è? –û —á—ë–º –¥—É–º–∞–µ—Ç—Å—è —Å —É—Ç—Ä–∞?",
    "–ü—Ä–∏–≤–µ—Ç üíõ –ö–∞–∫ —Å–ø–∞–ª–æ—Å—å? –ï—Å—Ç—å —á—Ç–æ-—Ç–æ, —á—Ç–æ —Ö–æ—á–µ—Ç—Å—è —Å–∫–∞–∑–∞—Ç—å –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –¥–µ–Ω—å –∑–∞–∫—Ä—É—Ç–∏—Ç?",
    "–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –ß—Ç–æ —Ö–æ—Ä–æ—à–µ–≥–æ –∂–¥—ë—à—å –æ—Ç —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–≥–æ –¥–Ω—è?",
    "–ü—Ä–∏–≤–µ—Ç ‚òÄÔ∏è –ü—Ä–æ—Å—Ç–æ —Ö–æ—Ç–µ–ª–∞ —É–∑–Ω–∞—Ç—å, –∫–∞–∫ —Ç—ã. –ß—Ç–æ –Ω–∞ –¥—É—à–µ?",
    "–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ üíõ –ö–∞–∫ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Ç–≤–æ–π –¥–µ–Ω—å? –ï—Å—Ç—å –º–∏–Ω—É—Ç–∫–∞ –¥–ª—è —Å–µ–±—è?",
]

# –í–µ—á–µ—Ä–Ω–∏–µ check-in —Å–æ–æ–±—â–µ–Ω–∏—è
EVENING_CHECKIN_PROMPTS: List[str] = [
    "–î–µ–Ω—å –ø–æ–¥—Ö–æ–¥–∏—Ç –∫ –∫–æ–Ω—Ü—É... –ö–∞–∫ —Ç—ã? –ï—Å—Ç—å —á—Ç–æ-—Ç–æ, —á—Ç–æ —Ö–æ—á–µ—Ç—Å—è –≤—ã–≥—Ä—É–∑–∏—Ç—å?",
    "–í–µ—á–µ—Ä üíõ –ö–∞–∫ –ø—Ä–æ—à—ë–ª –¥–µ–Ω—å? –ë—ã–ª–æ —á—Ç–æ-—Ç–æ, —á—Ç–æ –∑–∞—Ü–µ–ø–∏–ª–æ?",
    "–ü—Ä–∏–≤–µ—Ç. –ü—Ä–æ—Å—Ç–æ —Ö–æ—Ç–µ–ª–∞ —É–∑–Ω–∞—Ç—å, –∫–∞–∫ —Ç—ã —Å–µ–±—è —á—É–≤—Å—Ç–≤—É–µ—à—å –≤–µ—á–µ—Ä–æ–º. –í—Å—ë –≤ –ø–æ—Ä—è–¥–∫–µ?",
    "–í–µ—á–µ—Ä... –ö–∞–∫ —Ç—ã —Å–µ–≥–æ–¥–Ω—è? –ß—Ç–æ –±—ã–ª–æ —Å–∞–º—ã–º —Å–ª–æ–∂–Ω—ã–º?",
    "–î–µ–Ω—å –∑–∞–∫–æ–Ω—á–∏–ª—Å—è. –ö–∞–∫ —Ç—ã? –£–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —Ö–æ—Ç—å –º–∏–Ω—É—Ç–∫—É –¥–ª—è —Å–µ–±—è?",
]

# –ü—Ä–æ–º–ø—Ç—ã –¥–ª—è followup –ø–æ—Å–ª–µ —Ç—è–∂—ë–ª–æ–≥–æ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
FOLLOWUP_PROMPT_TEMPLATE = """
–¢—ã ‚Äî {persona_name}, –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –¥—Ä—É–≥-–Ω–∞—Å—Ç–∞–≤–Ω–∏–∫.

–í—á–µ—Ä–∞ –±—ã–ª –Ω–µ–ø—Ä–æ—Å—Ç–æ–π —Ä–∞–∑–≥–æ–≤–æ—Ä —Å {user_name}. –í–æ—Ç –∫—Ä–∞—Ç–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:
{conversation_summary}

–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π —Ç—ë–ø–ª–æ–µ, –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ-–ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å.

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- –ü–æ–∫–∞–∂–∏, —á—Ç–æ —Ç—ã –¥—É–º–∞–ª–∞ –æ –Ω–µ–π
- –£–ø–æ–º—è–Ω–∏ —á—Ç–æ-—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –∏–∑ –≤—á–µ—Ä–∞—à–Ω–µ–≥–æ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
- –ù–µ –±—É–¥—å —Ñ–æ—Ä–º–∞–ª—å–Ω–æ–π –∏–ª–∏ –Ω–∞–≤—è–∑—á–∏–≤–æ–π
- –ü—Ä–æ—Å—Ç–æ —Å–ø—Ä–æ—Å–∏ –∫–∞–∫ –æ–Ω–∞
- –î–ª–∏–Ω–∞: 1-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è

–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π —à–∞–±–ª–æ–Ω–Ω—ã—Ö —Ñ—Ä–∞–∑ –≤—Ä–æ–¥–µ "–ö–∞–∫ —Ç—ã —Å–µ–±—è —á—É–≤—Å—Ç–≤—É–µ—à—å?".
"""

# –ü—Ä–æ–º–ø—Ç –¥–ª—è —Ä–∏—Ç—É–∞–ª–∞ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏
GRATITUDE_RITUAL_PROMPT = """
–¢—ã ‚Äî {persona_name}, –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –¥—Ä—É–≥-–Ω–∞—Å—Ç–∞–≤–Ω–∏–∫.

–ü—Ä–µ–¥–ª–æ–∂–∏ {user_name} —Ä–∏—Ç—É–∞–ª –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏ –¥–Ω—è ‚Äî –Ω–∞–∑–≤–∞—Ç—å 3 –º–∞–ª–µ–Ω—å–∫–∏–µ —Ä–∞–¥–æ—Å—Ç–∏.

–ù–∞—á–Ω–∏ –º—è–≥–∫–æ, –Ω–µ –∫–æ–º–∞–Ω–¥—É–π. –û–±—ä—è—Å–Ω–∏, —á—Ç–æ —ç—Ç–æ –Ω–µ –ø—Ä–æ –≤–µ–ª–∏–∫–∏–µ —Å–æ–±—ã—Ç–∏—è, –∞ –ø—Ä–æ –º–µ–ª–æ—á–∏.
–ü—Ä–∏–º–µ—Ä—ã –º–∞–ª–µ–Ω—å–∫–∏—Ö —Ä–∞–¥–æ—Å—Ç–µ–π: –≤–∫—É—Å–Ω—ã–π –∫–æ—Ñ–µ, —Ç—ë–ø–ª–æ–µ –æ–¥–µ—è–ª–æ, —É–ª—ã–±–∫–∞ —Ä–µ–±—ë–Ω–∫–∞.

–ï—Å–ª–∏ –æ–Ω–∞ —Å–∫–∞–∂–µ—Ç "–Ω–∏—á–µ–≥–æ —Ö–æ—Ä–æ—à–µ–≥–æ" ‚Äî –ø—Ä–µ–¥–ª–æ–∂–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É: 
"—á—Ç–æ —Å–µ–≥–æ–¥–Ω—è –±—ã–ª–æ '–Ω–µ —Ç–∞–∫ –ø–ª–æ—Ö–æ, –∫–∞–∫ –º–æ–≥–ª–æ –±—ã'?"

–î–ª–∏–Ω–∞: 2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –Ω–∞—á–∞–ª–∞.
"""

# –ü—Ä–æ–º–ø—Ç –¥–ª—è –ø–∏—Å—å–º–∞ —Å–µ–±–µ
LETTER_RITUAL_PROMPT = """
–¢—ã ‚Äî {persona_name}, –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –¥—Ä—É–≥-–Ω–∞—Å—Ç–∞–≤–Ω–∏–∫.

–ü—Ä–µ–¥–ª–æ–∂–∏ {user_name} –Ω–∞–ø–∏—Å–∞—Ç—å –∫–æ—Ä–æ—Ç–∫–æ–µ –ø–∏—Å—å–º–æ —Å–µ–±–µ.

–í–∞—Ä–∏–∞–Ω—Ç—ã (–≤—ã–±–µ—Ä–∏ –æ–¥–∏–Ω, –ø–æ–¥—Ö–æ–¥—è—â–∏–π –ø–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É):
1. "–ü–∏—Å—å–º–æ —Å–µ–±–µ —á–µ—Ä–µ–∑ –º–µ—Å—è—Ü" ‚Äî —á—Ç–æ —Ö–æ—á–µ—à—å —Å–∫–∞–∑–∞—Ç—å –±—É–¥—É—â–µ–π —Å–µ–±–µ?
2. "–ü–∏—Å—å–º–æ —Å–µ–±–µ –ø—Ä–æ—à–ª–æ–π" ‚Äî —á—Ç–æ —Å–∫–∞–∑–∞–ª–∞ –±—ã —Å–µ–±–µ –≥–æ–¥ –Ω–∞–∑–∞–¥?
3. "–ü–∏—Å—å–º–æ –æ—Ç —Ç–æ–π, –∫–µ–º —Ö–æ—á–µ—à—å —Å—Ç–∞—Ç—å" ‚Äî —á—Ç–æ —Å–∫–∞–∑–∞–ª–∞ –±—ã —Ç–µ–±–µ —Ç—ã-–∏–∑-–º–µ—á—Ç—ã?

–ü—Ä–µ–¥–ª–æ–∂–∏ —ç—Ç–æ –º—è–≥–∫–æ, –∫–∞–∫ –∏–¥–µ—é, –Ω–µ –∫–∞–∫ –∑–∞–¥–∞–Ω–∏–µ.
–°–∫–∞–∂–∏, —á—Ç–æ —Å–æ—Ö—Ä–∞–Ω–∏—à—å –∏ –Ω–∞–ø–æ–º–Ω–∏—à—å (–µ—Å–ª–∏ —ç—Ç–æ –ø–∏—Å—å–º–æ –≤ –±—É–¥—É—â–µ–µ).

–î–ª–∏–Ω–∞: 3-4 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.
"""

# –ü—Ä–æ–º–ø—Ç –¥–ª—è –≥—Ä–∞–¥—É—Å–Ω–∏–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
THERMOMETER_RITUAL_PROMPT = """
–¢—ã ‚Äî {persona_name}, –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –¥—Ä—É–≥-–Ω–∞—Å—Ç–∞–≤–Ω–∏–∫.

–°–ø—Ä–æ—Å–∏ {user_name} –æ—Ü–µ–Ω–∏—Ç—å —Å–≤–æ—ë —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ —à–∫–∞–ª–µ –æ—Ç 1 –¥–æ 10.

–ù–µ –ø—Ä–æ—Å—Ç–æ —Å–ø—Ä–∞—à–∏–≤–∞–π —Ü–∏—Ñ—Ä—É ‚Äî —Å–æ–∑–¥–∞–π –∫–æ–Ω—Ç–µ–∫—Å—Ç:
- 1-3: "—Ç—è–∂–µ–ª–æ, –µ–ª–µ –¥–µ—Ä–∂—É—Å—å"
- 4-6: "—Ç–µ—Ä–ø–∏–º–æ, –Ω–æ –Ω–µ –æ—á–µ–Ω—å"
- 7-8: "—Ö–æ—Ä–æ—à–æ, —Å–ø—Ä–∞–≤–ª—è—é—Å—å"
- 9-10: "–æ—Ç–ª–∏—á–Ω–æ!"

–ü–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞:
- –ï—Å–ª–∏ –Ω–∏–∑–∫–∞—è –æ—Ü–µ–Ω–∫–∞ ‚Äî –ø—Ä–æ—è–≤–∏ –∑–∞–±–æ—Ç—É, —Å–ø—Ä–æ—Å–∏ —á—Ç–æ —Å–ª—É—á–∏–ª–æ—Å—å
- –ï—Å–ª–∏ —Å—Ä–µ–¥–Ω—è—è ‚Äî —Å–ø—Ä–æ—Å–∏ —á—Ç–æ –º–æ–≥–ª–æ –±—ã –ø–æ–¥–Ω—è—Ç—å –Ω–∞ 1 –ø—É–Ω–∫—Ç
- –ï—Å–ª–∏ –≤—ã—Å–æ–∫–∞—è ‚Äî –ø–æ—Ä–∞–¥—É–π—Å—è –≤–º–µ—Å—Ç–µ —Å –Ω–µ–π

–î–ª–∏–Ω–∞ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è: 2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.
"""


def get_ritual_prompt(
    ritual_type: str,
    user_data: Dict[str, Any],
    context: Optional[Dict[str, Any]] = None,
) -> Dict[str, str]:
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–∏—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è.
    
    Args:
        ritual_type: –¢–∏–ø —Ä–∏—Ç—É–∞–ª–∞
        user_data: –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        context: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
    
    Returns:
        {"system": str, "user": str}
    """
    persona_name = "–ú–∏—Ä–∞" if user_data.get("persona") == "mira" else "–ú–∞—Ä–∫"
    user_name = user_data.get("display_name", "–ø–æ–¥—Ä—É–≥–∞")
    
    if ritual_type == "morning_checkin":
        return {
            "system": f"–¢—ã ‚Äî {persona_name}, —Ç—ë–ø–ª—ã–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –¥—Ä—É–≥.",
            "user": f"–ù–∞–ø–∏—à–∏ –∫–æ—Ä–æ—Ç–∫–æ–µ —É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è {user_name}. "
                    "–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ, —Ç—ë–ø–ª–æ–µ, –±–µ–∑ –±–∞–Ω–∞–ª—å–Ω–æ—Å—Ç–µ–π. 1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.",
        }
    
    elif ritual_type == "evening_checkin":
        return {
            "system": f"–¢—ã ‚Äî {persona_name}, —Ç—ë–ø–ª—ã–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –¥—Ä—É–≥.",
            "user": f"–ù–∞–ø–∏—à–∏ –∫–æ—Ä–æ—Ç–∫–æ–µ –≤–µ—á–µ—Ä–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è {user_name}. "
                    "–°–ø—Ä–æ—Å–∏ –∫–∞–∫ –ø—Ä–æ—à—ë–ª –¥–µ–Ω—å. 1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.",
        }
    
    elif ritual_type == "followup":
        summary = context.get("conversation_summary", "–±—ã–ª –Ω–µ–ø—Ä–æ—Å—Ç–æ–π —Ä–∞–∑–≥–æ–≤–æ—Ä") if context else "–±—ã–ª –Ω–µ–ø—Ä–æ—Å—Ç–æ–π —Ä–∞–∑–≥–æ–≤–æ—Ä"
        return {
            "system": FOLLOWUP_PROMPT_TEMPLATE.format(
                persona_name=persona_name,
                user_name=user_name,
                conversation_summary=summary,
            ),
            "user": "–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π —Å–æ–æ–±—â–µ–Ω–∏–µ.",
        }
    
    elif ritual_type == "ritual_gratitude":
        return {
            "system": GRATITUDE_RITUAL_PROMPT.format(
                persona_name=persona_name,
                user_name=user_name,
            ),
            "user": "–ü—Ä–µ–¥–ª–æ–∂–∏ —Ä–∏—Ç—É–∞–ª –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏.",
        }
    
    elif ritual_type == "ritual_letter":
        return {
            "system": LETTER_RITUAL_PROMPT.format(
                persona_name=persona_name,
                user_name=user_name,
            ),
            "user": "–ü—Ä–µ–¥–ª–æ–∂–∏ –Ω–∞–ø–∏—Å–∞—Ç—å –ø–∏—Å—å–º–æ —Å–µ–±–µ.",
        }
    
    elif ritual_type == "ritual_thermometer":
        return {
            "system": THERMOMETER_RITUAL_PROMPT.format(
                persona_name=persona_name,
                user_name=user_name,
            ),
            "user": "–°–ø—Ä–æ—Å–∏ –æ—Ü–µ–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ.",
        }
    
    else:
        # –î–µ—Ñ–æ–ª—Ç–Ω—ã–π –ø—Ä–æ–º–ø—Ç
        return {
            "system": f"–¢—ã ‚Äî {persona_name}, —Ç—ë–ø–ª—ã–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –¥—Ä—É–≥.",
            "user": f"–ù–∞–ø–∏—à–∏ –∫–æ—Ä–æ—Ç–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è {user_name}.",
        }


def get_random_checkin(checkin_type: str = "morning") -> str:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª—É—á–∞–π–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ check-in."""
    if checkin_type == "morning":
        return random.choice(MORNING_CHECKIN_PROMPTS)
    else:
        return random.choice(EVENING_CHECKIN_PROMPTS)
