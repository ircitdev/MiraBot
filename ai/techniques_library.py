"""
Techniques Library.
–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Ö–Ω–∏–∫ –¥–ª—è –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –ø–æ–º–æ—â–∏.
"""

from typing import Dict, List, Optional, Any
from dataclasses import dataclass
from enum import Enum


class TechniqueCategory(str, Enum):
    """–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–µ—Ö–Ω–∏–∫."""
    GROUNDING = "grounding"          # –ó–∞–∑–µ–º–ª–µ–Ω–∏–µ
    BREATHING = "breathing"          # –î—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ
    ANXIETY = "anxiety"              # –†–∞–±–æ—Ç–∞ —Å —Ç—Ä–µ–≤–æ–≥–æ–π
    PANIC = "panic"                  # –ü–∞–Ω–∏–∫–∞
    ANGER = "anger"                  # –ó–ª–æ—Å—Ç—å
    SADNESS = "sadness"              # –ì—Ä—É—Å—Ç—å
    COGNITIVE = "cognitive"          # –ö–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–µ
    RELAXATION = "relaxation"        # –†–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ
    SELF_COMPASSION = "self_compassion"  # –°–∞–º–æ—Å–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏–µ


@dataclass
class Technique:
    """–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è —Ç–µ—Ö–Ω–∏–∫–∞."""
    id: str
    name: str
    category: TechniqueCategory
    duration_minutes: int
    description: str
    steps: List[str]
    keywords: List[str]  # –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –¥–µ—Ç–µ–∫—Ü–∏–∏
    contraindications: List[str] = None  # –ö–æ–≥–¥–∞ –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å


# –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Ç–µ—Ö–Ω–∏–∫
TECHNIQUES: Dict[str, Technique] = {

    # === –ó–ê–ó–ï–ú–õ–ï–ù–ò–ï ===
    "grounding_5_4_3_2_1": Technique(
        id="grounding_5_4_3_2_1",
        name="–¢–µ—Ö–Ω–∏–∫–∞ 5-4-3-2-1",
        category=TechniqueCategory.GROUNDING,
        duration_minutes=3,
        description="–¢–µ—Ö–Ω–∏–∫–∞ –∑–∞–∑–µ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ –æ—Ä–≥–∞–Ω—ã —á—É–≤—Å—Ç–≤. –ü–æ–º–æ–≥–∞–µ—Ç –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–æ–º–µ–Ω—Ç '–∑–¥–µ—Å—å –∏ —Å–µ–π—á–∞—Å'.",
        steps=[
            "–°—è–¥—å —É–¥–æ–±–Ω–æ –∏ —Å–¥–µ–ª–∞–π –≥–ª—É–±–æ–∫–∏–π –≤–¥–æ—Ö",
            "–ù–∞–∑–æ–≤–∏ 5 –≤–µ—â–µ–π, –∫–æ—Ç–æ—Ä—ã–µ —Ç—ã –í–ò–î–ò–®–¨ –≤–æ–∫—Ä—É–≥ —Å–µ–±—è",
            "–ù–∞–∑–æ–≤–∏ 4 –≤–µ—â–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ç—ã –º–æ–∂–µ—à—å –ü–û–¢–†–û–ì–ê–¢–¨",
            "–ù–∞–∑–æ–≤–∏ 3 –∑–≤—É–∫–∞, –∫–æ—Ç–æ—Ä—ã–µ —Ç—ã –°–õ–´–®–ò–®–¨",
            "–ù–∞–∑–æ–≤–∏ 2 –∑–∞–ø–∞—Ö–∞, –∫–æ—Ç–æ—Ä—ã–µ —Ç—ã –ß–£–í–°–¢–í–£–ï–®–¨",
            "–ù–∞–∑–æ–≤–∏ 1 –≤–∫—É—Å –≤–æ —Ä—Ç—É",
            "–°–¥–µ–ª–∞–π –≥–ª—É–±–æ–∫–∏–π –≤—ã–¥–æ—Ö. –¢—ã –∑–¥–µ—Å—å, –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏."
        ],
        keywords=["—Ç—Ä–µ–≤–æ–≥–∞", "–ø–∞–Ω–∏–∫–∞", "—Å—Ç—Ä–∞—Ö", "–Ω–µ –º–æ–≥—É —É—Å–ø–æ–∫–æ–∏—Ç—å—Å—è", "–∫—Ä—É–∂–∏—Ç—Å—è –≥–æ–ª–æ–≤–∞", "–æ—Ç–∫–ª—é—á–∞—é—Å—å"],
    ),

    "grounding_body_scan": Technique(
        id="grounding_body_scan",
        name="–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–∞",
        category=TechniqueCategory.GROUNDING,
        duration_minutes=5,
        description="–ú–µ–¥–ª–µ–Ω–Ω–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ –∫ –∫–∞–∂–¥–æ–π —á–∞—Å—Ç–∏ —Ç–µ–ª–∞ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ –Ω–∞—Å—Ç–æ—è—â–∏–π –º–æ–º–µ–Ω—Ç.",
        steps=[
            "–ó–∞–∫—Ä–æ–π –≥–ª–∞–∑–∞ –∏–ª–∏ —Å–º–æ—Ç—Ä–∏ –≤ –æ–¥–Ω—É —Ç–æ—á–∫—É",
            "–ü–æ—á—É–≤—Å—Ç–≤—É–π —Å–≤–æ–∏ —Å—Ç–æ–ø—ã ‚Äî –∫–∞–∫ –æ–Ω–∏ –∫–∞—Å–∞—é—Ç—Å—è –ø–æ–ª–∞?",
            "–ü–æ–¥–Ω–∏–º–∏—Å—å –≤–Ω–∏–º–∞–Ω–∏–µ–º –∫ –Ω–æ–≥–∞–º ‚Äî –æ–Ω–∏ —Ç—è–∂—ë–ª—ã–µ –∏–ª–∏ –ª—ë–≥–∫–∏–µ?",
            "–ü–æ—á—É–≤—Å—Ç–≤—É–π –∂–∏–≤–æ—Ç ‚Äî –æ–Ω –Ω–∞–ø—Ä—è–∂—ë–Ω –∏–ª–∏ —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω?",
            "–û–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –≥—Ä—É–¥—å ‚Äî –∫–∞–∫ —Ç—ã –¥—ã—à–∏—à—å?",
            "–ü–æ—á—É–≤—Å—Ç–≤—É–π –ø–ª–µ—á–∏ ‚Äî –æ–ø—É—Å—Ç–∏ –∏—Ö –µ—Å–ª–∏ –Ω–∞–ø—Ä—è–∂–µ–Ω—ã",
            "–õ–∏—Ü–æ ‚Äî —Ä–∞—Å—Å–ª–∞–±—å –ª–æ–±, —á–µ–ª—é—Å—Ç—å",
            "–ü–æ–±—É–¥—å –º–∏–Ω—É—Ç—É –≤ —ç—Ç–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç–∏"
        ],
        keywords=["–Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ", "–Ω–µ —á—É–≤—Å—Ç–≤—É—é —Ç–µ–ª–æ", "–¥–∏—Å—Å–æ—Ü–∏–∞—Ü–∏—è", "–∫–∞–∫ –≤–æ —Å–Ω–µ"],
    ),

    # === –î–´–•–ê–¢–ï–õ–¨–ù–´–ï ===
    "breathing_square": Technique(
        id="breathing_square",
        name="–ö–≤–∞–¥—Ä–∞—Ç–Ω–æ–µ –¥—ã—Ö–∞–Ω–∏–µ",
        category=TechniqueCategory.BREATHING,
        duration_minutes=3,
        description="–ü—Ä–æ—Å—Ç–∞—è —Ç–µ—Ö–Ω–∏–∫–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —É—Å–ø–æ–∫–æ–µ–Ω–∏—è –Ω–µ—Ä–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã.",
        steps=[
            "–°—è–¥—å —É–¥–æ–±–Ω–æ, —Å–ø–∏–Ω–∞ –ø—Ä—è–º–∞—è",
            "–í–¥–æ—Ö –Ω–∞ 4 —Å—á—ë—Ç–∞ (1-2-3-4)",
            "–ó–∞–¥–µ—Ä–∂–∫–∞ –¥—ã—Ö–∞–Ω–∏—è –Ω–∞ 4 —Å—á—ë—Ç–∞",
            "–í—ã–¥–æ—Ö –Ω–∞ 4 —Å—á—ë—Ç–∞",
            "–ó–∞–¥–µ—Ä–∂–∫–∞ –Ω–∞ 4 —Å—á—ë—Ç–∞",
            "–ü–æ–≤—Ç–æ—Ä–∏ 4-6 —Ü–∏–∫–ª–æ–≤",
            "–î—ã—à–∏ —Ä–æ–≤–Ω–æ –∏ —Å–ø–æ–∫–æ–π–Ω–æ"
        ],
        keywords=["—Ç—Ä–µ–≤–æ–≥–∞", "–Ω–µ—Ä–≤–Ω–∏—á–∞—é", "—Å–µ—Ä–¥—Ü–µ –±—å—ë—Ç—Å—è", "–Ω–µ –º–æ–≥—É —É—Å–ø–æ–∫–æ–∏—Ç—å—Å—è"],
    ),

    "breathing_4_7_8": Technique(
        id="breathing_4_7_8",
        name="–î—ã—Ö–∞–Ω–∏–µ 4-7-8",
        category=TechniqueCategory.BREATHING,
        duration_minutes=3,
        description="–†–∞—Å—Å–ª–∞–±–ª—è—é—â–µ–µ –¥—ã—Ö–∞–Ω–∏–µ –¥–ª—è —Å–Ω—è—Ç–∏—è —Å—Ç—Ä–µ—Å—Å–∞ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫–æ —Å–Ω—É.",
        steps=[
            "–Ø–∑—ã–∫ –ø—Ä–∏–∂–∞—Ç –∫ –Ω—ë–±—É –∑–∞ –ø–µ—Ä–µ–¥–Ω–∏–º–∏ –∑—É–±–∞–º–∏",
            "–í—ã–¥–æ—Ö–Ω–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —á–µ—Ä–µ–∑ —Ä–æ—Ç",
            "–í–¥–æ—Ö —á–µ—Ä–µ–∑ –Ω–æ—Å –Ω–∞ 4 —Å—á—ë—Ç–∞",
            "–ó–∞–¥–µ—Ä–∂–∫–∞ –¥—ã—Ö–∞–Ω–∏—è –Ω–∞ 7 —Å—á—ë—Ç–æ–≤",
            "–ú–µ–¥–ª–µ–Ω–Ω—ã–π –≤—ã–¥–æ—Ö —á–µ—Ä–µ–∑ —Ä–æ—Ç –Ω–∞ 8 —Å—á—ë—Ç–æ–≤",
            "–ü–æ–≤—Ç–æ—Ä–∏ 3-4 —Ü–∏–∫–ª–∞",
            "–ü–æ—á—É–≤—Å—Ç–≤—É–π –∫–∞–∫ —Ç–µ–ª–æ —Ä–∞—Å—Å–ª–∞–±–ª—è–µ—Ç—Å—è"
        ],
        keywords=["–Ω–µ –º–æ–≥—É —É—Å–Ω—É—Ç—å", "–±–µ—Å—Å–æ–Ω–Ω–∏—Ü–∞", "—Å—Ç—Ä–µ—Å—Å", "–ø–µ—Ä–µ–Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ"],
    ),

    # === –ü–ê–ù–ò–ö–ê ===
    "panic_cold_water": Technique(
        id="panic_cold_water",
        name="–•–æ–ª–æ–¥–Ω–∞—è –≤–æ–¥–∞ (diving reflex)",
        category=TechniqueCategory.PANIC,
        duration_minutes=1,
        description="–ë—ã—Å—Ç—Ä–∞—è —Ç–µ—Ö–Ω–∏–∫–∞ –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–∞–Ω–∏—á–µ—Å–∫–æ–π –∞—Ç–∞–∫–∏ —á–µ—Ä–µ–∑ —Ä–µ—Ñ–ª–µ–∫—Å –Ω—ã—Ä—è–Ω–∏—è.",
        steps=[
            "–ù–∞–±–µ—Ä–∏ —Ö–æ–ª–æ–¥–Ω—É—é –≤–æ–¥—É –≤ –ª–∞–¥–æ–Ω–∏",
            "–û–ø—É—Å—Ç–∏ –ª–∏—Ü–æ –≤ –≤–æ–¥—É –Ω–∞ 30 —Å–µ–∫—É–Ω–¥",
            "–ò–ª–∏ –ø—Ä–∏–ª–æ–∂–∏ –ª—ë–¥/—Ö–æ–ª–æ–¥–Ω–æ–µ –∫ –≤–∏—Å–∫–∞–º –∏ —â–µ–∫–∞–º",
            "–î—ã—à–∏ –º–µ–¥–ª–µ–Ω–Ω–æ",
            "–•–æ–ª–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Ä–µ—Ñ–ª–µ–∫—Å –Ω—ã—Ä—è–Ω–∏—è ‚Äî —Å–µ—Ä–¥—Ü–µ –∑–∞–º–µ–¥–ª—è–µ—Ç—Å—è",
            "–ü–æ–≤—Ç–æ—Ä–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏"
        ],
        keywords=["–ø–∞–Ω–∏–∫–∞", "–ø–∞–Ω–∏—á–µ—Å–∫–∞—è –∞—Ç–∞–∫–∞", "–∑–∞–¥—ã—Ö–∞—é—Å—å", "—Å–µ—Ä–¥—Ü–µ –≤—ã—Å–∫–∞–∫–∏–≤–∞–µ—Ç", "—É–º–∏—Ä–∞—é"],
    ),

    "panic_safe_place": Technique(
        id="panic_safe_place",
        name="–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –º–µ—Å—Ç–æ",
        category=TechniqueCategory.PANIC,
        duration_minutes=5,
        description="–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –≤—ã—Ö–æ–¥–∞ –∏–∑ –æ—Å—Ç—Ä–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ç—Ä–µ–≤–æ–≥–∏.",
        steps=[
            "–ó–∞–∫—Ä–æ–π –≥–ª–∞–∑–∞",
            "–í—Å–ø–æ–º–Ω–∏ –º–µ—Å—Ç–æ, –≥–¥–µ —Ç—ã —á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∞ —Å–µ–±—è –≤ –ø–æ–ª–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏",
            "–≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–µ–∞–ª—å–Ω–æ–µ –∏–ª–∏ –≤–æ–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –º–µ—Å—Ç–æ",
            "–ü—Ä–µ–¥—Å—Ç–∞–≤—å –¥–µ—Ç–∞–ª–∏: —Ü–≤–µ—Ç–∞, –∑–≤—É–∫–∏, –∑–∞–ø–∞—Ö–∏",
            "–ü–æ—á—É–≤—Å—Ç–≤—É–π –∫–∞–∫ —Ç–µ–ª–æ —Ä–∞—Å—Å–ª–∞–±–ª—è–µ—Ç—Å—è –≤ —ç—Ç–æ–º –º–µ—Å—Ç–µ",
            "–ü–æ–±—É–¥—å —Ç–∞–º 3-5 –º–∏–Ω—É—Ç",
            "–ö–æ–≥–¥–∞ –±—É–¥–µ—à—å –≥–æ—Ç–æ–≤–∞ ‚Äî –º–µ–¥–ª–µ–Ω–Ω–æ –æ—Ç–∫—Ä–æ–π –≥–ª–∞–∑–∞"
        ],
        keywords=["—Å—Ç—Ä–∞—à–Ω–æ", "–Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ", "–±–æ—é—Å—å", "—É–∂–∞—Å"],
    ),

    # === –¢–†–ï–í–û–ì–ê ===
    "anxiety_worry_time": Technique(
        id="anxiety_worry_time",
        name="–í—Ä–µ–º—è –¥–ª—è —Ç—Ä–µ–≤–æ–≥–∏",
        category=TechniqueCategory.ANXIETY,
        duration_minutes=15,
        description="–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è —Ç—Ä–µ–≤–æ–∂–Ω—ã—Ö –º—ã—Å–ª–µ–π —á—Ç–æ–±—ã –Ω–µ —Ç—Ä–µ–≤–æ–∂–∏—Ç—å—Å—è –≤–µ—Å—å –¥–µ–Ω—å.",
        steps=[
            "–í—ã–¥–µ–ª–∏ 15 –º–∏–Ω—É—Ç –≤ –¥–µ–Ω—å ‚Äî '–≤—Ä–µ–º—è –¥–ª—è —Ç—Ä–µ–≤–æ–≥–∏'",
            "–í —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è, –µ—Å–ª–∏ –ø—Ä–∏—Ö–æ–¥–∏—Ç —Ç—Ä–µ–≤–æ–∂–Ω–∞—è –º—ã—Å–ª—å ‚Äî –∑–∞–ø–∏—à–∏ –µ—ë –∏ –æ—Ç–ª–æ–∂–∏ –¥–æ —ç—Ç–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏",
            "–í –æ—Ç–≤–µ–¥—ë–Ω–Ω–æ–µ –≤—Ä–µ–º—è ‚Äî —Ä–∞–∑—Ä–µ—à–∏ —Å–µ–±–µ —Ç—Ä–µ–≤–æ–∂–∏—Ç—å—Å—è",
            "–ü—Ä–æ—Å–º–æ—Ç—Ä–∏ –≤—Å–µ –∑–∞–ø–∏—Å–∞–Ω–Ω—ã–µ –º—ã—Å–ª–∏",
            "–î–ª—è –∫–∞–∂–¥–æ–π: —á—Ç–æ —è –º–æ–≥—É —Å–¥–µ–ª–∞—Ç—å? –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ ‚Äî –æ—Ç–ø—É—Å–∫–∞—é",
            "–ö–æ–≥–¥–∞ 15 –º–∏–Ω—É—Ç –ø—Ä–æ—à–ª–∏ ‚Äî —Ç—Ä–µ–≤–æ–≥–∞ –∑–∞–∫–æ–Ω—á–µ–Ω–∞ –¥–æ –∑–∞–≤—Ç—Ä–∞"
        ],
        keywords=["–ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ç—Ä–µ–≤–æ–∂—É—Å—å", "–º—ã—Å–ª–∏ –∫—Ä—É—Ç—è—Ç—Å—è", "–Ω–µ –º–æ–≥—É –ø–µ—Ä–µ—Å—Ç–∞—Ç—å –¥—É–º–∞—Ç—å", "–≤—Å—ë –≤—Ä–µ–º—è –±–µ—Å–ø–æ–∫–æ—é—Å—å"],
    ),

    "anxiety_worst_case": Technique(
        id="anxiety_worst_case",
        name="–•—É–¥—à–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π",
        category=TechniqueCategory.ANXIETY,
        duration_minutes=10,
        description="–ü—Ä–æ—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä–∞—Ö–∞ —á–µ—Ä–µ–∑ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∏ –ø—Ä–∏–Ω—è—Ç–∏–µ —Ö—É–¥—à–µ–≥–æ –∏—Å—Ö–æ–¥–∞.",
        steps=[
            "–ó–∞–ø–∏—à–∏: —á–µ–≥–æ —è –±–æ—é—Å—å?",
            "–ß—Ç–æ —Å–∞–º–æ–µ —Ö—É–¥—à–µ–µ –º–æ–∂–µ—Ç —Å–ª—É—á–∏—Ç—å—Å—è?",
            "–ï—Å–ª–∏ —ç—Ç–æ —Å–ª—É—á–∏—Ç—Å—è ‚Äî –∫–∞–∫ —è —Å–ø—Ä–∞–≤–ª—é—Å—å?",
            "–ö—Ç–æ –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å?",
            "–ü–µ—Ä–µ–∂–∏–≤–∞–ª–∞ –ª–∏ —è —á—Ç–æ-—Ç–æ –ø–æ–¥–æ–±–Ω–æ–µ —Ä–∞–Ω—å—à–µ?",
            "–ö–∞–∫–æ–≤–∞ —Ä–µ–∞–ª—å–Ω–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ö—É–¥—à–µ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è?",
            "–ß—Ç–æ —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ?"
        ],
        keywords=["–±–æ—é—Å—å —á—Ç–æ", "–∞ –≤–¥—Ä—É–≥", "—á—Ç–æ –µ—Å–ª–∏", "–∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞"],
    ),

    # === –ó–õ–û–°–¢–¨ ===
    "anger_grounding": Technique(
        id="anger_grounding",
        name="–ó–∞–∑–µ–º–ª–µ–Ω–∏–µ –∑–ª–æ—Å—Ç–∏",
        category=TechniqueCategory.ANGER,
        duration_minutes=5,
        description="–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –≤—ã—Ö–æ–¥ –¥–ª—è —Å–∏–ª—å–Ω–æ–π –∑–ª–æ—Å—Ç–∏.",
        steps=[
            "–ü—Ä–∏–∑–Ω–∞–π: '–Ø –∑–ª—é—Å—å –∏ —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ'",
            "–ï—Å–ª–∏ –º–æ–∂–µ—à—å ‚Äî –≤—ã–π–¥–∏ –∏–∑ —Å–∏—Ç—É–∞—Ü–∏–∏ –Ω–∞ 5 –º–∏–Ω—É—Ç",
            "–§–∏–∑–∏—á–µ—Å–∫–∏–π —Å–±—Ä–æ—Å: —Å–æ–∂–º–∏ –∫—É–ª–∞–∫–∏ –Ω–∞ 10 —Å–µ–∫—É–Ω–¥ ‚Üí –æ—Ç–ø—É—Å—Ç–∏",
            "–ü–æ–≤—Ç–æ—Ä–∏ 3 —Ä–∞–∑–∞",
            "–ü–æ–¥—ã—à–∏ –≥–ª—É–±–æ–∫–æ: –≤–¥–æ—Ö –Ω–æ—Å–æ–º, –≤—ã–¥–æ—Ö —Ä—Ç–æ–º",
            "–°–ø—Ä–æ—Å–∏ —Å–µ–±—è: —á—Ç–æ –º–µ–Ω—è —Ä–∞–Ω–∏–ª–æ –ø–æ–¥ —ç—Ç–æ–π –∑–ª–æ—Å—Ç—å—é?",
            "–ß—Ç–æ –º–Ω–µ –Ω—É–∂–Ω–æ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ?"
        ],
        keywords=["–∑–ª—é—Å—å", "–±–µ—à—É—Å—å", "–Ω–µ–Ω–∞–≤–∏–∂—É", "—Ö–æ—á—É —É–±–∏—Ç—å", "–≤–∑–æ—Ä–≤—É—Å—å"],
    ),

    # === –ì–†–£–°–¢–¨ ===
    "sadness_container": Technique(
        id="sadness_container",
        name="–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —á—É–≤—Å—Ç–≤",
        category=TechniqueCategory.SADNESS,
        duration_minutes=5,
        description="–¢–µ—Ö–Ω–∏–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–∏–ª—å–Ω—ã–º–∏ —á—É–≤—Å—Ç–≤–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞—Ö–ª—ë—Å—Ç—ã–≤–∞—é—Ç.",
        steps=[
            "–ü—Ä–µ–¥—Å—Ç–∞–≤—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä ‚Äî –∫–æ—Ä–æ–±–∫—É, —Å–µ–π—Ñ, —à–∫–∞—Ç—É–ª–∫—É",
            "–õ—é–±–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞",
            "–ü–æ–ª–æ–∂–∏ —Ç—É–¥–∞ —á—É–≤—Å—Ç–≤–æ, –∫–æ—Ç–æ—Ä–æ–µ —Å–µ–π—á–∞—Å —Å–ª–∏—à–∫–æ–º —Å–∏–ª—å–Ω–æ–µ",
            "–ó–∞–∫—Ä–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä",
            "–ó–Ω–∞–π: —á—É–≤—Å—Ç–≤–æ –Ω–∏–∫—É–¥–∞ –Ω–µ –¥–µ–Ω–µ—Ç—Å—è, —Ç—ã –≤–µ—Ä–Ω—ë—à—å—Å—è –∫ –Ω–µ–º—É –∫–æ–≥–¥–∞ –±—É–¥–µ—à—å –≥–æ—Ç–æ–≤–∞",
            "–°–µ–π—á–∞—Å –æ–Ω–æ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ",
            "–ú–æ–∂–µ—à—å –æ—Ç–∫—Ä—ã—Ç—å –∫–æ–≥–¥–∞ –∑–∞—Ö–æ—á–µ—à—å"
        ],
        keywords=["–∑–∞—Ö–ª—ë—Å—Ç—ã–≤–∞–µ—Ç", "—Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ", "–Ω–µ —Å–ø—Ä–∞–≤–ª—è—é—Å—å", "—Ç–æ–Ω—É"],
    ),

    "sadness_self_hug": Technique(
        id="sadness_self_hug",
        name="–°–∞–º–æ-–æ–±—ä—è—Ç–∏–µ",
        category=TechniqueCategory.SELF_COMPASSION,
        duration_minutes=2,
        description="–§–∏–∑–∏—á–µ—Å–∫–∏–π –∂–µ—Å—Ç –∑–∞–±–æ—Ç—ã –æ —Å–µ–±–µ.",
        steps=[
            "–û–±–Ω–∏–º–∏ —Å–µ–±—è —Ä—É–∫–∞–º–∏ ‚Äî –ø–æ–ª–æ–∂–∏ –ø—Ä–∞–≤—É—é —Ä—É–∫—É –Ω–∞ –ª–µ–≤–æ–µ –ø–ª–µ—á–æ, –ª–µ–≤—É—é –Ω–∞ –ø—Ä–∞–≤–æ–µ",
            "–°–ª–µ–≥–∫–∞ —Å–æ–∂–º–∏ ‚Äî –∫–∞–∫ –æ–±–Ω–∏–º–∞–µ—à—å –¥—Ä—É–≥–∞",
            "–°–∫–∞–∂–∏ —Å–µ–±–µ: '–°–µ–π—á–∞—Å –º–Ω–µ —Ç—è–∂–µ–ª–æ'",
            "'–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å —Ç–æ, —á—Ç–æ —è —á—É–≤—Å—Ç–≤—É—é'",
            "'–Ø –∑–∞–±–æ—á—É—Å—å –æ —Å–µ–±–µ'",
            "–ü–æ–±—É–¥—å –≤ –æ–±—ä—è—Ç–∏–∏ –º–∏–Ω—É—Ç—É",
            "–ü–æ–≥–ª–∞–¥—å —Å–µ–±—è –ø–æ –ø–ª–µ—á–∞–º"
        ],
        keywords=["–æ–¥–∏–Ω–æ–∫–æ", "–Ω–∏–∫–æ–º—É –Ω–µ –Ω—É–∂–Ω–∞", "—Ö–æ—á—É –æ–±–Ω—è—Ç—å", "–ø–æ–¥–¥–µ—Ä–∂–∫–∏"],
    ),

    # === –ö–û–ì–ù–ò–¢–ò–í–ù–´–ï ===
    "cognitive_thought_record": Technique(
        id="cognitive_thought_record",
        name="–ó–∞–ø–∏—Å—å –º—ã—Å–ª–µ–π",
        category=TechniqueCategory.COGNITIVE,
        duration_minutes=10,
        description="–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –ö–ü–¢-—Ç–µ—Ö–Ω–∏–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–º–∏ –º—ã—Å–ª—è–º–∏.",
        steps=[
            "–ó–∞–ø–∏—à–∏ —Å–∏—Ç—É–∞—Ü–∏—é: —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ?",
            "–ó–∞–ø–∏—à–∏ –º—ã—Å–ª—å: —á—Ç–æ —è –ø–æ–¥—É–º–∞–ª–∞?",
            "–ó–∞–ø–∏—à–∏ —ç–º–æ—Ü–∏—é: —á—Ç–æ –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∞? (0-10)",
            "–ù–∞–π–¥–∏ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –ó–ê —ç—Ç—É –º—ã—Å–ª—å",
            "–ù–∞–π–¥–∏ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –ü–†–û–¢–ò–í",
            "–°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π –±–æ–ª–µ–µ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é –º—ã—Å–ª—å",
            "–û—Ü–µ–Ω–∏ —ç–º–æ—Ü–∏—é —Å–Ω–æ–≤–∞ (0-10)"
        ],
        keywords=["–Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –º—ã—Å–ª–∏", "–¥—É–º–∞—é –ø–ª–æ—Ö–æ–µ", "–∫—Ä–∏—Ç–∏–∫—É—é —Å–µ–±—è", "–≤—Å—ë —É–∂–∞—Å–Ω–æ"],
    ),

    "cognitive_decatastrophizing": Technique(
        id="cognitive_decatastrophizing",
        name="–î–µ–∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏–∑–∞—Ü–∏—è",
        category=TechniqueCategory.COGNITIVE,
        duration_minutes=5,
        description="–¢–µ—Ö–Ω–∏–∫–∞ –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏–∑–∏—Ä—É—é—â–∏—Ö –º—ã—Å–ª–µ–π.",
        steps=[
            "–ó–∞–ø–∏—à–∏ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏—á–µ—Å–∫—É—é –º—ã—Å–ª—å",
            "–ö–∞–∫–æ–≤–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —ç—Ç–æ–≥–æ? (0-100%)",
            "–ß—Ç–æ —Å–∞–º–æ–µ —Ö—É–¥—à–µ–µ? –°–º–æ–≥—É –ª–∏ —è —ç—Ç–æ –ø–µ—Ä–µ–∂–∏—Ç—å?",
            "–ß—Ç–æ —Å–∞–º–æ–µ –ª—É—á—à–µ–µ, —á—Ç–æ –º–æ–∂–µ—Ç —Å–ª—É—á–∏—Ç—å—Å—è?",
            "–ß—Ç–æ —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç?",
            "–ï—Å–ª–∏ —ç—Ç–æ —Å–ª—É—á–∏—Ç—Å—è —á–µ—Ä–µ–∑ –≥–æ–¥ ‚Äî –±—É–¥—É –ª–∏ —è —Ç–∞–∫ –∂–µ –ø–µ—Ä–µ–∂–∏–≤–∞—Ç—å?",
            "–ö–∞–∫–æ–π —Å–æ–≤–µ—Ç —è –¥–∞–ª–∞ –±—ã –ø–æ–¥—Ä—É–≥–µ?"
        ],
        keywords=["–∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞", "–∫–æ–Ω–µ—Ü —Å–≤–µ—Ç–∞", "–≤—Å—ë –ø—Ä–æ–ø–∞–ª–æ", "–Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è"],
    ),
}


def get_technique_by_id(technique_id: str) -> Optional[Technique]:
    """–ü–æ–ª—É—á–∏—Ç—å —Ç–µ—Ö–Ω–∏–∫—É –ø–æ ID."""
    return TECHNIQUES.get(technique_id)


def get_techniques_by_category(category: TechniqueCategory) -> List[Technique]:
    """–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ç–µ—Ö–Ω–∏–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏."""
    return [t for t in TECHNIQUES.values() if t.category == category]


def find_techniques_by_keywords(text: str) -> List[Technique]:
    """
    –ù–∞–π—Ç–∏ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ —Ç–µ—Ö–Ω–∏–∫–∏ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º –≤ —Ç–µ–∫—Å—Ç–µ.

    Args:
        text: –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

    Returns:
        –°–ø–∏—Å–æ–∫ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö —Ç–µ—Ö–Ω–∏–∫ (–æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏)
    """
    text_lower = text.lower()
    results = []

    for technique in TECHNIQUES.values():
        score = 0
        for keyword in technique.keywords:
            if keyword in text_lower:
                score += 1

        if score > 0:
            results.append((technique, score))

    # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏
    results.sort(key=lambda x: x[1], reverse=True)

    return [t for t, _ in results]


def format_technique_for_user(technique: Technique) -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Ç–µ—Ö–Ω–∏–∫—É –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

    Args:
        technique: –¢–µ—Ö–Ω–∏–∫–∞ –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

    Returns:
        –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
    """
    steps_text = "\n".join([f"{i+1}. {step}" for i, step in enumerate(technique.steps)])

    return f"""‚ú® **{technique.name}** (~{technique.duration_minutes} –º–∏–Ω)

{technique.description}

**–®–∞–≥–∏:**
{steps_text}

üíõ –ü–æ–ø—Ä–æ–±—É–π –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å?"""


def get_quick_technique_for_context(emotion: str) -> Optional[Technique]:
    """
    –ü–æ–ª—É—á–∏—Ç—å –±—ã—Å—Ç—Ä—É—é —Ç–µ—Ö–Ω–∏–∫—É –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —ç–º–æ—Ü–∏–∏.

    Args:
        emotion: –≠–º–æ—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (angry, anxious, sad, panic)

    Returns:
        –ü–æ–¥—Ö–æ–¥—è—â–∞—è —Ç–µ—Ö–Ω–∏–∫–∞ –∏–ª–∏ None
    """
    emotion_map = {
        "angry": "anger_grounding",
        "anxious": "breathing_square",
        "sad": "sadness_self_hug",
        "panic": "panic_cold_water",
        "scared": "grounding_5_4_3_2_1",
        "overwhelmed": "sadness_container",
        "stressed": "breathing_4_7_8",
    }

    technique_id = emotion_map.get(emotion.lower())
    if technique_id:
        return TECHNIQUES.get(technique_id)

    return None


# –°–ø–∏—Å–æ–∫ —Ç–µ—Ö–Ω–∏–∫ –¥–ª—è –ø—Ä–æ–º–ø—Ç–∞
def get_techniques_summary_for_prompt() -> str:
    """
    –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫—Ä–∞—Ç–∫–∏–π —Å–ø–∏—Å–æ–∫ —Ç–µ—Ö–Ω–∏–∫ –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞.
    """
    categories = {}
    for t in TECHNIQUES.values():
        cat_name = t.category.value
        if cat_name not in categories:
            categories[cat_name] = []
        categories[cat_name].append(t.name)

    lines = ["**–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ –ø–æ–º–æ—â–∏:**"]
    for cat, techniques in categories.items():
        lines.append(f"- {cat}: {', '.join(techniques)}")

    return "\n".join(lines)
