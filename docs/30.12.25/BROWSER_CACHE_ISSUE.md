# Проблема с кешем браузера

**Дата:** 30.12.2025
**Проблема:** Колонка API показывает старый формат `$0.0000` вместо нового `$0.00`

## Причина

Браузер использует закешированную версию файла `admin.html`, несмотря на то, что:
1. Файл был обновлен на сервере
2. Установлены заголовки `Cache-Control: no-cache, no-store, must-revalidate`

## Решение

### Вариант 1: Жесткая перезагрузка страницы

**Windows/Linux:**
- `Ctrl + Shift + R`
- или `Ctrl + F5`

**Mac:**
- `Cmd + Shift + R`

### Вариант 2: Очистка кеша браузера

**Chrome:**
1. Открыть DevTools (F12)
2. Правый клик на кнопке "Обновить"
3. Выбрать "Очистить кеш и жесткая перезагрузка"

**Firefox:**
1. `Ctrl + Shift + Delete`
2. Выбрать "Кеш"
3. Нажать "Удалить сейчас"

### Вариант 3: Режим инкогнито

Открыть админ-панель в режиме инкогнито:
- `Ctrl + Shift + N` (Chrome)
- `Ctrl + Shift + P` (Firefox)

## Проверка

После очистки кеша колонка API должна показывать:
- `$0.00` для пользователей без расходов
- `$X.XX` для пользователей с расходами (2 знака после запятой)

## Технические детали

### Текущие заголовки кеширования (webapp/api/main.py:65-69):

```python
headers={
    "Cache-Control": "no-cache, no-store, must-revalidate",
    "Pragma": "no-cache",
    "Expires": "0"
}
```

Эти заголовки должны предотвращать кеширование, но некоторые браузеры могут игнорировать их.

### Проверенный код (webapp/frontend/admin.html:7866-7867):

```javascript
const apiCostHtml = apiCost > 0
    ? `<span style="color: var(--md-sys-color-primary); font-weight: 500;">$${apiCost.toFixed(2)}</span>`
    : '<span style="color: var(--md-sys-color-outline);">$0.00</span>';
```

✅ Код правильный - использует `.toFixed(2)` и `$0.00`

## Примечания

### Почему пользователи показывают $0.00?

В базе данных есть расходы только для одного пользователя:
- `User ID: 1`
- `Telegram ID: 65876198`
- `Cost: $0.00` (округлено до 2 знаков)

Все остальные пользователи в таблице (1392513515, 813910081, и т.д.) не имеют записей в `api_costs`, поэтому для них корректно показывается `$0.00`.

### Когда появятся данные?

Данные начнут появляться автоматически, когда пользователи:
1. Отправят сообщение боту (Claude API)
2. Получат голосовое сообщение (Yandex TTS)

Каждое взаимодействие будет автоматически логироваться в таблицу `api_costs`.
