# Изменение формата отображения API costs

**Дата:** 30.12.2025
**Задача:** Изменить формат отображения стоимости с 4 знаков после запятой на 2

## Изменения

Обновлен формат отображения денежных сумм в админ-панели:
- **Было:** `$0.0000` (4 знака после запятой)
- **Стало:** `$0.00` (2 знака после запятой)

### Измененные места в admin.html

1. **Дашборд - карточки API расходов** (строки 7715-7717)
   - Сегодня: `costToday.toFixed(2)`
   - За неделю: `costWeek.toFixed(2)`
   - За месяц: `costMonth.toFixed(2)`

2. **Таблица пользователей - колонка API** (строки 7856-7857)
   - Если есть расходы: `apiCost.toFixed(2)`
   - Если нет расходов: `$0.00`

3. **Детальная информация о пользователе** (строки 7998, 8006, 8011)
   - Общая стоимость: `apiCosts.total_cost.toFixed(2)`
   - По провайдерам: `cost.toFixed(2)`
   - Если нет данных: `$0.00`

4. **Раздел Reports - токены и стоимость** (строка 8930)
   - Стоимость отчета: `report.cost_usd.toFixed(2)`

5. **Вкладка "Расходы API" в Analytics** (строка 3978)
   - Начальное значение: `$0.00`

6. **Статистика расходов API** (строка 10268)
   - Всего потрачено: `statsData.total_cost.toFixed(2)`

7. **График расходов API**
   - Tooltip (строка 10334): `context.parsed.y.toFixed(2)`
   - Ось Y (строка 10356): `value.toFixed(2)`

## Обоснование

Два знака после запятой достаточно для отображения стоимости в USD:
- Более читаемо для пользователя
- Стандартный формат отображения денежных сумм
- 4 знака были избыточны для отображения (хотя в БД хранится точное значение)

## Технические детали

- В базе данных стоимость хранится как `FLOAT` с полной точностью
- Расчеты производятся с высокой точностью (6 знаков)
- Форматирование применяется только при отображении пользователю

### Примеры расчетов (остаются без изменений):

**Claude Sonnet 4:**
```python
input_cost = (input_tokens / 1_000_000) * 3.0
output_cost = (output_tokens / 1_000_000) * 15.0
total_cost = round(input_cost + output_cost, 6)  # Хранится с 6 знаками
# Отображается: total_cost.toFixed(2)
```

**Yandex TTS:**
```python
cost_usd = (characters / 1_000_000) * 0.12  # Хранится точное значение
# Отображается: cost_usd.toFixed(2)
```

## Файлы изменений

- `webapp/frontend/admin.html` - обновлен формат отображения (9 мест)

## Результат

Все денежные суммы в админ-панели теперь отображаются в формате `$X.XX`:
- Таблица пользователей: `$0.00`, `$0.12`, `$1.50`
- Дашборд: `$0.00`, `$5.23`
- Графики и статистика: `$0.00`, `$10.45`
- Детальная информация: `$0.00`, `$2.34`
