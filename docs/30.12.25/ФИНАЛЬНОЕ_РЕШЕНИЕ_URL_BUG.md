# ‚úÖ –§–ò–ù–ê–õ–¨–ù–û–ï –†–ï–®–ï–ù–ò–ï: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ URL –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏–∏

**–î–∞—Ç–∞:** 30.12.2025
**–ü—Ä–æ–±–ª–µ–º–∞:** API costs –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏ –æ—à–∏–±–∫–∏, –∑–∞—Ç–µ–º –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Å–ª–æ–º–∞–ª–∏—Å—å

## üîç –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–±–ª–µ–º—ã

### –≠—Ç–∞–ø 1: –ò—Å—Ö–æ–¥–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞
```
URL: /api/adminapi-costs/users/123 ‚ùå
–ü—Ä–∏—á–∏–Ω–∞: –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å /
```

### –≠—Ç–∞–ø 2: –ü–µ—Ä–≤–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (—Å–æ–∑–¥–∞–ª–æ –Ω–æ–≤—É—é –ø—Ä–æ–±–ª–µ–º—É)
```javascript
// –î–æ–±–∞–≤–∏–ª–∏ / –º–µ–∂–¥—É base –∏ endpoint
const response = await fetch(`${API_BASE}/${endpoint}`, {
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** API costs –∑–∞—Ä–∞–±–æ—Ç–∞–ª–∏, –Ω–æ —Å–ª–æ–º–∞–ª–∏—Å—å –í–°–ï –æ—Å—Ç–∞–ª—å–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã!

```
URL: /api/admin//users ‚ùå
URL: /api/admin//stats/system ‚ùå
URL: /api/admin//analytics/activity ‚ùå
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø–µ—Ä–µ–¥–∞–≤–∞–ª–∏—Å—å —Å `/` –≤ –Ω–∞—á–∞–ª–µ:
- `endpoint = '/users'` ‚Üí `/api/admin/` + `/users` = `/api/admin//users`

–ê –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –±–µ–∑ `/`:
- `endpoint = 'api-costs/users/123'` ‚Üí `/api/admin/` + `api-costs` = `/api/admin/api-costs` ‚úÖ

### –≠—Ç–∞–ø 3: –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
```javascript
// –£–º–Ω–∞—è –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—è —Å —É–¥–∞–ª–µ–Ω–∏–µ–º –¥–≤–æ–π–Ω—ã—Ö —Å–ª–µ—à–µ–π
const url = `${API_BASE}/${endpoint}`.replace(/([^:]\/)\/+/g, '$1');
const response = await fetch(url, {
```

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç regex:**
- `([^:]\/)` - –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –ª—é–±–æ–π `/` –∫—Ä–æ–º–µ `://` (—á—Ç–æ–±—ã –Ω–µ —Å–ª–æ–º–∞—Ç—å `http://`)
- `\/+` - –Ω–∞—Ö–æ–¥–∏—Ç –æ–¥–∏–Ω –∏–ª–∏ –±–æ–ª–µ–µ `/` –ø–æ—Å–ª–µ –Ω–µ–≥–æ
- `$1` - –∑–∞–º–µ–Ω—è–µ—Ç –Ω–∞ –∑–∞—Ö–≤–∞—á–µ–Ω–Ω—É—é –≥—Ä—É–ø–ø—É (–æ–¥–∏–Ω `/`)

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- `/api/admin//users` ‚Üí `/api/admin/users` ‚úÖ
- `/api/admin/api-costs` ‚Üí `/api/admin/api-costs` ‚úÖ
- `http://localhost` ‚Üí `http://localhost` ‚úÖ (–Ω–µ —Ç—Ä–æ–≥–∞–µ—Ç `://`)

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

1. –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `apiRequest()` –≤ [admin.html:7654-7656](../webapp/frontend/admin.html#L7654-L7656)
2. –ó–∞–≥—Ä—É–∂–µ–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –Ω–∞ —Å–µ—Ä–≤–µ—Ä
3. –í–µ–±-—Å–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

### 1. –ñ—ë—Å—Ç–∫–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

**–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û:** –ë—Ä–∞—É–∑–µ—Ä –∫–µ—à–∏—Ä—É–µ—Ç —Å—Ç–∞—Ä—ã–π —Ñ–∞–π–ª!

```
Ctrl + Shift + R (–∏–ª–∏ Ctrl + F5)
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ —Å–µ–∫—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å:

#### ‚úÖ –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ö–æ–ª–æ–Ω–∫–∞ "API" –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞—Å—Ö–æ–¥—ã ($0.00 –∏–ª–∏ —Ä–µ–∞–ª—å–Ω—ã–µ —Å—É–º–º—ã)

#### ‚úÖ –î–∞—à–±–æ—Ä–¥ (–≥–ª–∞–≤–Ω–∞—è)
–í—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –¥–∞–Ω–Ω—ã–µ:
- –°–∏—Å—Ç–µ–º–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- API —Ä–∞—Å—Ö–æ–¥—ã (–¥–µ–Ω—å/–Ω–µ–¥–µ–ª—è/–º–µ—Å—è—Ü)
- –¢–æ–ø –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

#### ‚úÖ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
–í—Å–µ –≥—Ä–∞—Ñ–∏–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è:
- –ì—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- –ì—Ä–∞—Ñ–∏–∫ –ø–æ–¥–ø–∏—Å–æ–∫
- –ì—Ä–∞—Ñ–∏–∫ —Ä–∞—Å—Ö–æ–¥–æ–≤ API
- Retention

#### ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∫–ª–∏–∫ –Ω–∞ –∏–º—è)
```
–î–µ—Ç–∞–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: –õ–∏–∑–∞
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
API –¢–æ–∫–µ–Ω–æ–≤:    0
API –†–∞—Å—Ö–æ–¥—ã:    $0.00
```

## üîß –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ DevTools

–û—Ç–∫—Ä–æ–π—Ç–µ F12 ‚Üí Network ‚Üí –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.

**–î–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤—Å–µ 200 OK:**
- ‚úÖ `/api/admin/users?limit=500` ‚Üí 200 OK
- ‚úÖ `/api/admin/stats/system` ‚Üí 200 OK
- ‚úÖ `/api/admin/analytics/activity` ‚Üí 200 OK
- ‚úÖ `/api/admin/analytics/subscriptions` ‚Üí 200 OK
- ‚úÖ `/api/admin/analytics/retention` ‚Üí 200 OK
- ‚úÖ `/api/admin/api-costs/stats` ‚Üí 200 OK
- ‚úÖ `/api/admin/api-costs/by-date` ‚Üí 200 OK
- ‚úÖ `/api/admin/api-costs/users/summary` ‚Üí 200 OK

**–ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
- ‚ùå 404 Not Found
- ‚ùå –î–≤–æ–π–Ω—ã—Ö —Å–ª–µ—à–µ–π (`//`) –≤ URL

## üìä –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥

**–§–∞–π–ª:** `webapp/frontend/admin.html`
**–°—Ç—Ä–æ–∫–∏:** 7654-7656

```javascript
async function apiRequest(endpoint, options = {}) {
    const headers = {
        'Content-Type': 'application/json',
    };

    if (adminToken) {
        headers['Authorization'] = `Bearer ${adminToken}`;
    } else if (tg && tg.initData) {
        headers['X-Telegram-Init-Data'] = tg.initData;
    }

    // Ensure proper URL construction without double slashes
    const url = `${API_BASE}/${endpoint}`.replace(/([^:]\/)\/+/g, '$1');
    const response = await fetch(url, {
        ...options,
        headers: {
            ...headers,
            ...options.headers,
        },
    });

    // ... rest of the function
}
```

### –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏–∏

| API_BASE | endpoint | –î–æ regex | –ü–æ—Å–ª–µ regex | –°—Ç–∞—Ç—É—Å |
|----------|----------|----------|-------------|--------|
| `/api/admin` | `/users` | `/api/admin//users` | `/api/admin/users` | ‚úÖ |
| `/api/admin` | `users` | `/api/admin/users` | `/api/admin/users` | ‚úÖ |
| `/api/admin` | `api-costs/stats` | `/api/admin/api-costs/stats` | `/api/admin/api-costs/stats` | ‚úÖ |
| `/api/admin` | `/stats/system` | `/api/admin//stats/system` | `/api/admin/stats/system` | ‚úÖ |

## üéØ –ò—Ç–æ–≥

‚úÖ **–í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã**

–û–¥–∏–Ω regex —Ä–µ—à–∏–ª –æ–±–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. –£–±—Ä–∞–ª –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Å–ª–µ—à–∏ (–±—ã–ª–æ: `adminapi-costs`)
2. –£–±—Ä–∞–ª –ª–∏—à–Ω–∏–µ —Å–ª–µ—à–∏ (–±—ã–ª–æ: `admin//users`)

**–î–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
1. Ctrl + Shift + R (–∂—ë—Å—Ç–∫–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞)
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ —Å–µ–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç

**–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–ª–∞—Å—å:**
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä–µ–∂–∏–º –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ (Ctrl + Shift + N)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DevTools ‚Üí Network –Ω–∞ –Ω–∞–ª–∏—á–∏–µ 404

–í—Å—ë –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –∏–¥–µ–∞–ª—å–Ω–æ! üéâ
