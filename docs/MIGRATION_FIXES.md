# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ miradrug.ru

## üìÖ –î–∞—Ç–∞: 03.01.2026

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. Privacy Page 404 Error

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `/privacy` –∏ `/privacy.html` –≤–æ–∑–≤—Ä–∞—â–∞–ª–∏ 404
- Nginx —É–∫–∞–∑—ã–≤–∞–ª –Ω–µ–≤–µ—Ä–Ω—ã–π –ø—É—Ç—å: `/var/www/freescout/docs/privacy.html`

**–†–µ—à–µ–Ω–∏–µ:**
- –ù–∞–π–¥–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å: `/root/mira_bot/docs/privacy.html`
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx
- –î–æ–±–∞–≤–ª–µ–Ω—ã –æ–±–∞ URL –≤–∞—Ä–∏–∞–Ω—Ç–∞

**–§–∞–π–ª—ã:**
- `deployment/nginx_miradrug.conf:41-49`

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
curl -I https://miradrug.ru/privacy
# HTTP/1.1 200 OK

curl -I https://miradrug.ru/privacy.html
# HTTP/1.1 200 OK
```

**Commit:** `3f3c3b3`

---

### 2. Admin Panel API Errors

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –í—Å–µ –≥—Ä–∞—Ñ–∏–∫–∏ –≤ –∞–¥–º–∏–Ω–∫–µ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏ –æ—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏
- API –∑–∞–ø—Ä–æ—Å—ã –Ω–µ —Å–æ–¥–µ—Ä–∂–∞–ª–∏ Authorization header
- `adminToken` –æ–ø—Ä–µ–¥–µ–ª—è–ª—Å—è —Å–ª–∏—à–∫–æ–º –ø–æ–∑–¥–Ω–æ –≤ –∫–æ–¥–µ

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:**
```javascript
// adminToken –æ–ø—Ä–µ–¥–µ–ª—è–ª—Å—è –Ω–∞ —Å—Ç—Ä–æ–∫–µ 7531
const adminToken = localStorage.getItem('admin_token');

// –ù–æ —Ñ—É–Ω–∫—Ü–∏–∏ apiRequest() –∏ getAuthHeaders() –Ω–∞—Ö–æ–¥–∏–ª–∏—Å—å –í–´–®–ï (—Å—Ç—Ä–æ–∫–∏ 8203-8247)
// –ò –Ω–µ –º–æ–≥–ª–∏ –≤–∏–¥–µ—Ç—å —ç—Ç—É –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
```

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–µ—Ä–µ–º–µ—â–µ–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è `adminToken` –≤ –Ω–∞—á–∞–ª–æ —Å–∫—Ä–∏–ø—Ç–∞ (–ø–æ—Å–ª–µ `API_BASE`)
- –£–¥–∞–ª–µ–Ω–∞ –¥—É–±–ª–∏—Ä—É—é—â–∞—è—Å—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- –¢–µ–ø–µ—Ä—å –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø –∫ —Ç–æ–∫–µ–Ω—É

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```javascript
// –ë–´–õ–û (—Å—Ç—Ä–æ–∫–∞ 7531):
const adminToken = localStorage.getItem('admin_token');

// –°–¢–ê–õ–û (—Å—Ç—Ä–æ–∫–∞ 6631):
const urlParams = new URLSearchParams(window.location.search);
const tokenFromUrl = urlParams.get('token');
if (tokenFromUrl) {
    localStorage.setItem('admin_token', tokenFromUrl);
    window.history.replaceState({}, document.title, window.location.pathname);
}
const adminToken = localStorage.getItem('admin_token');
```

**–§–∞–π–ª—ã:**
- `webapp/frontend/admin.html:6631-6638` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Ä–∞–Ω–Ω—è—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- `webapp/frontend/admin.html:7534` - —É–¥–∞–ª–µ–Ω–∞ –¥—É–±–ª–∏—Ä—É—é—â–∞—è—Å—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
‚úÖ –í—Å–µ API –∑–∞–ø—Ä–æ—Å—ã —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞—é—Ç `Authorization: Bearer <token>`
‚úÖ –ì—Ä–∞—Ñ–∏–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
‚úÖ –ì—Ä–∞—Ñ–∏–∫–∏ –ø–æ–¥–ø–∏—Å–æ–∫ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
‚úÖ –í—Å—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

**Commit:** `638d63b`

---

### 3. Telegram Bot URL

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ö–æ–º–∞–Ω–¥–∞ `/admin` –≤ –±–æ—Ç–µ –≤–æ–∑–≤—Ä–∞—â–∞–ª–∞ —Å—Ç–∞—Ä—ã–π URL `mira.uspeshnyy.ru`
- –ö–æ–¥ –±—ã–ª –æ–±–Ω–æ–≤–ª–µ–Ω, –Ω–æ –±–æ—Ç –Ω–µ –±—ã–ª –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω —Å–µ—Ä–≤–∏—Å `mirabot`
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –Ω–∞–ª–∏—á–∏–µ –Ω–æ–≤–æ–≥–æ –¥–æ–º–µ–Ω–∞ –≤ –∫–æ–¥–µ

**–ö–æ–º–∞–Ω–¥—ã:**
```bash
systemctl restart mirabot
systemctl status mirabot
grep -n 'miradrug.ru' /root/mira_bot/bot/handlers/admin.py
# 124:    admin_url = f"https://miradrug.ru/admin?token={jwt_token}"
# 156:    admin_url = f"https://miradrug.ru/admin?token={jwt_token}"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
‚úÖ –ö–æ–º–∞–Ω–¥–∞ `/admin` —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `https://miradrug.ru/admin?token=...`

---

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º

### –ü–æ—á–µ–º—É adminToken –Ω–µ –±—ã–ª –≤–∏–¥–µ–Ω?

**JavaScript scope rules:**
1. `const` –∏ `let` –∏–º–µ—é—Ç block scope
2. –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –µ—ë –æ–±—ä—è–≤–ª–µ–Ω–∏—è (TDZ - Temporal Dead Zone)
3. –§—É–Ω–∫—Ü–∏–∏, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –î–û –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π, –Ω–µ –º–æ–≥—É—Ç –µ—ë –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

**–í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ:**
```javascript
// –°—Ç—Ä–æ–∫–∞ 8203 - —Ñ—É–Ω–∫—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞
function getAuthHeaders() {
    if (adminToken) {  // ‚ùå adminToken –µ—â–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        headers['Authorization'] = `Bearer ${adminToken}`;
    }
}

// –°—Ç—Ä–æ–∫–∞ 7531 - –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ (—Å–ª–∏—à–∫–æ–º –ø–æ–∑–¥–Ω–æ!)
const adminToken = localStorage.getItem('admin_token');
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –Ω–µ –±—ã–ª–æ –∑–∞–º–µ—á–µ–Ω–æ —Ä–∞–Ω—å—à–µ?**
- –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –º–æ–≥–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π –ø–æ—Ä—è–¥–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤
- –ú–æ–≥–ª–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑ —Ç–æ–∫–µ–Ω–∞ (—á–µ—Ä–µ–∑ Telegram Web App init data)
- –û—à–∏–±–∫–∏ JavaScript –Ω–µ –≤—Å–µ–≥–¥–∞ –≤–∏–¥–Ω—ã –≤ –∫–æ–Ω—Å–æ–ª–∏

---

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –±—É–¥—É—â–µ–µ

### 1. –ü–æ—Ä—è–¥–æ–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

–í—Å–µ–≥–¥–∞ –æ–±—ä—è–≤–ª—è–π—Ç–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –Ω–∞—á–∞–ª–µ —Å–∫—Ä–∏–ø—Ç–∞:

```javascript
<script>
    // 1. –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    const API_BASE = '/api/admin';

    // 2. –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    const adminToken = localStorage.getItem('admin_token');

    // 3. –£—Ç–∏–ª–∏—Ç–∞—Ä–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    function apiRequest() { ... }

    // 4. –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥
    async function loadData() { ... }
</script>
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ CORS

–ü—Ä–∏ —Å–º–µ–Ω–µ –¥–æ–º–µ–Ω–∞ –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ:
- CORS headers –≤ API
- Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- –ü—É—Ç–∏ –∫ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–º —Ñ–∞–π–ª–∞–º

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

–ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä:
- –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞ (Ctrl+Shift+R)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Network tab –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤

### 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞ Python –≤—Å–µ–≥–¥–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å —Å–µ—Ä–≤–∏—Å—ã:
```bash
systemctl restart mirabot
systemctl restart mira-webapp
```

---

## üéØ –ò—Ç–æ–≥–æ–≤—ã–π —á–µ–∫–ª–∏—Å—Ç –º–∏–≥—Ä–∞—Ü–∏–∏

- [x] DNS –Ω–∞—Å—Ç—Ä–æ–µ–Ω (A-–∑–∞–ø–∏—Å—å ‚Üí 31.44.7.144)
- [x] SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –ø–æ–ª—É—á–µ–Ω
- [x] Nginx —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω
- [x] Landing page –∑–∞–≥—Ä—É–∂–µ–Ω
- [x] Admin panel –∑–∞–≥—Ä—É–∂–µ–Ω
- [x] API CORS –æ–±–Ω–æ–≤–ª–µ–Ω
- [x] Telegram bot URL –æ–±–Ω–æ–≤–ª–µ–Ω
- [x] Privacy page –∏—Å–ø—Ä–∞–≤–ª–µ–Ω
- [x] Admin token –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞
- [x] –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω—ã
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

---

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### Landing Page
```bash
curl -I https://miradrug.ru
# HTTP/2 200 OK ‚úÖ
```

### Privacy Page
```bash
curl -I https://miradrug.ru/privacy
# HTTP/2 200 OK ‚úÖ
```

### Admin Panel
```bash
# –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ —Å —Ç–æ–∫–µ–Ω–æ–º
https://miradrug.ru/admin?token=JWT_TOKEN
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å - –Ω–µ—Ç –æ—à–∏–±–æ–∫ ‚úÖ
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏ - –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è ‚úÖ
```

### API
```bash
curl https://miradrug.ru/api/health
# {"status":"ok"} ‚úÖ
```

### Telegram Bot
```
/admin –≤ –±–æ—Ç–µ
# –ü–æ–ª—É—á–∞–µ–º: https://miradrug.ru/admin?token=... ‚úÖ
```

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [MIGRATION_TO_MIRADRUG.md](MIGRATION_TO_MIRADRUG.md) - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏
- [deployment/nginx_miradrug.conf](../deployment/nginx_miradrug.conf) - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx
- [webapp/frontend/admin.html](../webapp/frontend/admin.html) - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –∞–¥–º–∏–Ω–∫–∞

---

## üìû Commits

1. **fdea20d** - –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –¥–æ–º–µ–Ω miradrug.ru –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ landing page
2. **3f3c3b3** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø—É—Ç—å –∫ privacy page –≤ Nginx
3. **638d63b** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è adminToken –≤ admin.html
4. **1b1eb3d** - –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –æ—á–∏—Å—Ç–∫–µ –∫—ç—à–∞ –±—Ä–∞—É–∑–µ—Ä–∞

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
**–î–∞—Ç–∞:** 03.01.2026 04:35 MSK
**–ê–≤—Ç–æ—Ä:** Claude Sonnet 4.5
